gossfile:
  ../nginx/base.goss.yaml: {}

group:
  www-data:
    exists: true
command:
  php -m:
    exit-status: 0
    stderr: ['!/./']
  php -v:
    exit-status: 0
    stderr: ['!/./']
  php-fpm7.0 -m:
    exit-status: 0
    stderr: ['!/./']
  php-fpm7.0 -v:
    exit-status: 0
    stderr: ['!/./']
  php -r 'echo PHP_MAJOR_VERSION;':
    exit-status: 0
    stdout: [7]
    stderr: ['!/./']
  php -r 'echo PHP_MINOR_VERSION;':
    exit-status: 0
    stdout: [0]
    stderr: ['!/./']
file:
  /etc/nginx/sites-available/default:
    exists: true
    contains:
      - listen 8080;
      - server_name web;
      - root /app/public;
      - client_max_body_size 1m;
      - index  index.html index.php;
      - location / {
      - try_files $uri $uri/ /index.php?$args;
      - location ~ \.php$ {
      - try_files $uri =404;
      - sendfile on;
      - fastcgi_read_timeout 60s;
      - fastcgi_send_timeout 60s;
      - fastcgi_connect_timeout 60s;
      - fastcgi_keep_conn off;
      - fastcgi_buffers 256 16k;
      - fastcgi_buffer_size 128k;
      - fastcgi_busy_buffers_size 256k;
      - include /etc/nginx/fastcgi_params;
      - fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
      - fastcgi_pass 127.0.0.1:9000;
      - location ~ ^/__status$ {
      - access_log off;
      - allow 127.0.0.1;
      - deny all;
      - include fastcgi_params;
      - fastcgi_pass 127.0.0.1:9000;
      - location /__nginx_status {
      - location ~ /\. {
      - log_not_found off;
  /etc/nginx/fastcgi_params:
    exists: true
    contains:
      - fastcgi_param   QUERY_STRING            $query_string;
      - fastcgi_param   REQUEST_METHOD          $request_method;
      - fastcgi_param   CONTENT_TYPE            $content_type;
      - fastcgi_param   CONTENT_LENGTH          $content_length;
      - fastcgi_param   SCRIPT_FILENAME         $document_root$fastcgi_script_name;
      - fastcgi_param   SCRIPT_NAME             $fastcgi_script_name;

      - fastcgi_param   PATH_TRANSLATED   $document_root$fastcgi_path_info;
      - fastcgi_param   REQUEST_URI             $request_uri;
      - fastcgi_param   DOCUMENT_URI            $document_uri;
      - fastcgi_param   DOCUMENT_ROOT           $document_root;
      - fastcgi_param   SERVER_PROTOCOL         $server_protocol;

      - fastcgi_param   GATEWAY_INTERFACE       CGI/1.1;
      - fastcgi_param   SERVER_SOFTWARE         nginx/$nginx_version;

      - fastcgi_param   REMOTE_ADDR             $remote_addr;
      - fastcgi_param   REMOTE_PORT             $remote_port;
      - fastcgi_param   SERVER_ADDR             $server_addr;
      - fastcgi_param   SERVER_PORT             $server_port;
      - fastcgi_param   SERVER_NAME             $server_name;
      - fastcgi_param   HTTPS                   $https;
      - fastcgi_param   HTTP_PROXY              "";
      - fastcgi_param   REDIRECT_STATUS         200;
      - fastcgi_pass_header Authorization;
